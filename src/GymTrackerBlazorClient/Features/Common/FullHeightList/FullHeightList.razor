@using System.Collections.Immutable;
@using GymTracker.BlazorClient.Features.Common;
@using GymTracker.BlazorClient.Shared.Extensions;

<div class="fullHeight" style="position: relative">
    <MudPaper Class="pa-0 fullHeight" style="overflow-y: auto; position: relative;">
        @Filter
        <MudList 
            Class="z-0"
            Color="Color.Info"
            Clickable="true"
            SelectedValue="SelectedId">
            @foreach (var (item, index) in List.LoopIndex())
            {
                <MudListItem 
                    OnClick="() => OnItemClick.InvokeAsync(item)"
                    Value="item.Id"
                    Style="@(item.IsAcitve ? "" : $"color: {Theme.PaletteDark.TextDisabled}")">
                    <div class="d-flex flex-row">
                        <MudText Typo="Typo.subtitle1">@item.Name</MudText>
                        @WhenEnabledShowReorderButtons(index)
                    </div>
                </MudListItem>
            }
        </MudList>
    </MudPaper>
    @if (OnAddItem.HasDelegate)
    {
        <div class="d-flex flex-row-reverse" style="position: absolute; bottom: 15px; right: 15px">
            <MudFab Color="Color.Dark"
                    StartIcon="@Icons.Material.Filled.Add"
                    OnClick="_ => OnAddItem.InvokeAsync()" />
        </div>
    }
</div>

@code {
    RenderFragment? WhenEnabledShowReorderButtons(int index)
    => CanReorder && List[index].Id == SelectedId
        ? @<div class="d-flex flex-column" style="margin-left: auto">
            <MudIconButton 
                       Icon="@Icons.Material.Filled.ArrowDropUp"
                       Size="Size.Small"
                       Style="padding: 0"></MudIconButton>
            <MudIconButton 
                       Icon="@Icons.Material.Filled.ArrowDropDown"
                       Size="Size.Small"
                       Style="padding: 0"></MudIconButton>
           </div>
        : null;
}


@code {
    [Parameter]
    public RenderFragment? Filter { get; set; }

    [Parameter, EditorRequired]
    public ImmutableArray<ListItem> List { get; set; } = ImmutableArray<ListItem>.Empty;

    [Parameter]
    public EventCallback<ListItem> OnItemClick { get; set; }

    [Parameter]
    public Guid? SelectedId { get; set; } = null;

    [Parameter]
    public EventCallback OnAddItem { get; set; }

    [Parameter]
    public bool CanReorder { get; set; } = false;

    MudTheme Theme = new();
}
